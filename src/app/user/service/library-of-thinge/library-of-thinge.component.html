<h3 class="text-center">Library of Things</h3>
<p class="text-center">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
<!-- Search & Category Select -->
<div class="container my-4">
  <!-- Filter controls that change based on active tab -->
  <div class="row mb-4">
    <!-- Filters for Items tab -->
    <ng-container *ngIf="activeTab === 'items'">
      <div class="col-md-6">
        <select class="form-select" (change)="onCategoryChange($event)">
          <option *ngFor="let category of categories" [value]="category.id" [selected]="category.id === selectedCategory">
            {{ category.name }}
          </option>
        </select>
      </div>
      <div class="col-md-6">
        <select class="form-select" (change)="onStatusChange($event)">
          <option *ngFor="let st of status" [value]="st.id" [selected]="st.id === selectedStatus">
            {{ st.name }}
          </option>
        </select>
      </div>
    </ng-container>
    
    <!-- Filters for History tab -->
    <ng-container *ngIf="activeTab === 'history'">
      <div class="col-md-6">
        <select class="form-select" (change)="onBorrowStatusChange($event)">
          <option *ngFor="let option of borrowStatusOptions" [value]="option.id" [selected]="option.id === selectedBorrowStatus">
            {{ option.name }}
          </option>
        </select>
      </div>
      <div class="col-md-6">
        <input 
          type="date" 
          class="form-control" 
          [value]="selectedBorrowDate" 
          (change)="onBorrowDateChange($event)"
          placeholder="‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°">
      </div>
    </ng-container>
  </div>

  <ul class="nav nav-tabs">
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'items'" (click)="setActiveTab('items')" data-bs-toggle="tab" href="#items">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" [class.active]="activeTab === 'history'" (click)="setActiveTab('history')" data-bs-toggle="tab" href="#history">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</a>
    </li>
  </ul>

  <div class="tab-content mt-3">
    <!-- üì¶ Tab ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå -->
    <div class="tab-pane fade" [class.show]="activeTab === 'items'" [class.active]="activeTab === 'items'" id="items">
      <div class="list-group">
        <div *ngIf="items.length === 0" class="alert alert-info">
          ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </div>
        <div *ngFor="let item of items" class="list-group-item list-group-item-action" 
             [class.disabled]="item.availableQuantity === 0"
             (click)="item.availableQuantity > 0 && item.status === '‡∏ß‡πà‡∏≤‡∏á' && openBorrowModal(item)">
          <div class="d-flex justify-content-between align-items-center">
            <div>
              <h6 class="mb-1">{{ getItemEmoji(item.category) }} {{ item.name }}</h6>
              <p class="mb-1">{{ item.description }}</p>
              <small>
                ‡∏™‡∏†‡∏≤‡∏û: {{ item.condition }} | 
                <span [ngClass]="{'text-success': item.availableQuantity > 0, 'text-danger': item.availableQuantity === 0}">
                  ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ item.availableQuantity }}/{{ item.totalQuantity }}
                </span> | 
                ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: {{ item.maxBorrowDays }} ‡∏ß‡∏±‡∏ô
              </small>
            </div>
            <span class="badge" 
                  [ngClass]="{
                    'bg-success': item.availableQuantity > 0 && item.status === '‡∏ß‡πà‡∏≤‡∏á',
                    'bg-warning text-dark': item.status === '‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°',
                    'bg-danger': item.status === '‡∏ã‡πà‡∏≠‡∏°'
                  }">
              <ng-container *ngIf="item.availableQuantity > 0 && item.status === '‡∏ß‡πà‡∏≤‡∏á'">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏∑‡∏°</ng-container>
              <ng-container *ngIf="item.status === '‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°'">‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á</ng-container>
              <ng-container *ngIf="item.status === '‡∏ã‡πà‡∏≠‡∏°'">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡πà‡∏≠‡∏°</ng-container>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- üìú Tab ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° -->
    <div class="tab-pane fade" [class.show]="activeTab === 'history'" [class.active]="activeTab === 'history'" id="history">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h5>
          <p class="card-text">‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</p>
          <div class="list-group">
            <div *ngIf="borrowingHistory.length === 0" class="alert alert-info">
              ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç
            </div>
            <div *ngFor="let record of borrowingHistory" class="list-group-item list-group-item-action">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">{{ record.itemName }}</h6>
                  <p class="mb-1">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°: {{ record.borrower }} | ‡∏£‡∏´‡∏±‡∏™: {{ record.borrowerId }}</p>
                  <small>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°: {{ record.borrowDate }} | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô: {{ record.returnDate || '-' }}</small>
                </div>
                <span class="badge" 
                      [ngClass]="{
                        'bg-success': record.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß',
                        'bg-warning text-dark': record.status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô' && !record.isOverdue,
                        'bg-info': record.status === '‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß',
                        'bg-danger': record.isOverdue
                      }">
                  <ng-container *ngIf="record.status === '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß'">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</ng-container>
                  <ng-container *ngIf="record.status === '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏Ñ‡∏∑‡∏ô' && !record.isOverdue">üïí ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</ng-container>
                  <ng-container *ngIf="record.status === '‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß'">üóìÔ∏è ‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß</ng-container>
                  <ng-container *ngIf="record.isOverdue">‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</ng-container>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Borrow Modal -->
  <div class="modal" [class.show]="showBorrowModal" [style.display]="showBorrowModal ? 'block' : 'none'" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">‡∏à‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h5>
          <button type="button" class="btn-close" (click)="closeBorrowModal()"></button>
        </div>
        <div class="modal-body" *ngIf="selectedItemForBorrow">
          <div class="mb-3">
            <h6>{{ getItemEmoji(selectedItemForBorrow.category) }} {{ selectedItemForBorrow.name }}</h6>
            <p class="text-muted small">{{ selectedItemForBorrow.description }}</p>

          </div>
          <!-- <div class="alert alert-info">
            <small>
              <i class="bi bi-info-circle"></i> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î {{ selectedItemForBorrow.maxBorrowDays }} ‡∏ß‡∏±‡∏ô<br>
              <i class="bi bi-box"></i> ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ selectedItemForBorrow.availableQuantity }}/{{ selectedItemForBorrow.totalQuantity }}
            </small>
          </div> -->
          <form>
            <hr>
            <h6>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</h6>
     
            <div class="mb-3">
              <label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤/‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</label>
              <input type="text" class="form-control" [(ngModel)]="borrowForm.borrowerId" name="borrowerId" required>
              <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
              <input type="text" class="form-control" [(ngModel)]="borrowForm.borrowerName" name="borrowerName" required>
            </div>
            <!-- <div class="mb-3">
              <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
              <input type="text" class="form-control" [(ngModel)]="borrowForm.borrowerName" name="borrowerName" required>
            </div> -->
            <div class="mb-3">
              <h6>‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</h6>
              <hr>
              <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
              <input type="date" class="form-control" [(ngModel)]="borrowForm.pickupDate" 
                    (change)="onPickupDateChange($event)" 
                    name="pickupDate" 
                    [min]="getDateConstraints().min"
                    [max]="getDateConstraints().max"
                    required>
              <small class="text-muted">* ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏±‡∏ö‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤ 1 ‡∏ß‡∏±‡∏ô</small>
            </div>
            <div class="mb-3">
              <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</label>
              <input type="date" class="form-control" [(ngModel)]="borrowForm.returnDate" 
                     name="returnDate" readonly>
              <!-- <small class="text-muted">* ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</small> -->
            </div>
            <div class="alert alert-warning">
              <small>
                <i class="bi bi-info-circle"></i> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ô‡∏µ‡πâ‡∏¢‡∏∑‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î {{ selectedItemForBorrow.maxBorrowDays }} ‡∏ß‡∏±‡∏ô<br>
                <i class="bi bi-info-circle"></i>‡∏´‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ñ‡∏ô‡∏±‡∏î‡πÑ‡∏õ<br>
                <!-- <i class="bi bi-box"></i> ‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ selectedItemForBorrow.availableQuantity }}/{{ selectedItemForBorrow.totalQuantity }} -->
              </small>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" (click)="closeBorrowModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
          <button type="button" class="btn btn-primary" (click)="submitBorrowForm()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal Backdrop -->
  <div class="modal-backdrop fade show" *ngIf="showBorrowModal"></div>
</div>

